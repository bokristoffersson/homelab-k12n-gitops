apiVersion: v1
kind: ConfigMap
metadata:
  name: energy-ws-config
  namespace: energy-ws
data:
  config.yaml: |
    kafka:
      brokers: "redpanda-v2.redpanda-v2.svc.cluster.local:9092"
      topic: "homelab-energy-realtime"
      group_id: "energy-ws"
      auto_offset_reset: "latest"  # Only new messages for real-time

    server:
      host: "0.0.0.0"
      port: 8080
      max_connections: 1000

    auth:
      # Multi-issuer JWKS-based validation (RS256) for Authentik tokens
      issuers:
        # Homelab macOS - Native app (public client, JWT validation via JWKS)
        - name: homelab-macos
          issuer: "https://authentik.k12n.com/application/o/homelab-macos/"
          jwks_url: "https://authentik.k12n.com/application/o/homelab-macos/jwks/"

        # oauth2-proxy - Web app (JWT validation via JWKS)
        - name: oauth2-proxy
          issuer: "https://authentik.k12n.com/application/o/oauth2-proxy/"
          jwks_url: "https://authentik.k12n.com/application/o/oauth2-proxy/jwks/"

      # Placeholder for legacy HS256 - not used when issuers[] is configured
      jwt_secret: "placeholder"
