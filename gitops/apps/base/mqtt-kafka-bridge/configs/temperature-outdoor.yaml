input:
  mqtt:
    urls:
      - tcp://mosquitto.mosquitto.svc.cluster.local:1883
    topics:
      - homelab/temperature/outdoor
    client_id: mqtt-redpanda-bridge-temperature-outdoor
    user: ${MQTT_USER}
    password: ${MQTT_PASSWORD}
    clean_session: true
    qos: 1

pipeline:
  processors:
    - mapping: |
        root = this
        root.ts = now().ts_format("2006-01-02T15:04:05.999999999Z07:00")
        root.tags.device_id = "outdoor-sensor"
        root.tags.mac_address = null
        root.tags.location = "outdoor"
        root.fields.temperature_c = this.temperature_c
        root.fields.temperature_f = null
        root.fields.humidity = this.humidity_pct | null
        root.fields.wifi_rssi = null
        root.fields.battery_voltage = null
        root.fields.battery_percent = null
        root.fields.external_power = null
        root.fields.uptime = null
        root.fields.ram_free = null
        root.fields.wind_speed_ms = this.wind_speed_ms | null
        root.fields.pressure_hpa = this.pressure_hpa | null

output:
  kafka:
    addresses:
      - ${REDPANDA_BROKERS}
    topic: homelab-temperature-outdoor
    client_id: mqtt-redpanda-bridge-temperature-outdoor
    compression: snappy
    max_in_flight: 10
