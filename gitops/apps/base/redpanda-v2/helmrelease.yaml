apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: redpanda-v2
  namespace: redpanda-v2
spec:
  interval: 10m
  chart:
    spec:
      chart: redpanda
      version: "25.1.2"
      sourceRef:
        kind: HelmRepository
        name: redpanda
        namespace: flux-system
  values:
    # Override cluster name to avoid conflicts with old deployment
    fullnameOverride: "redpanda-v2"

    # Resource configuration (25.x uses different structure)
    resources:
      cpu:
        cores: 1
      memory:
        container:
          max: 2Gi

    statefulset:
      replicas: 1

    storage:
      persistentVolume:
        enabled: true
        size: 50Gi
        storageClass: longhorn

    tls:
      enabled: false

    # Console configuration with basePath for subpath hosting
    console:
      enabled: true
      config:
        server:
          basePath: /admin/redpanda
          stripPrefix: false  # Traefik already strips the prefix
        authentication:
          useSecureCookies: true
          oidc:
            enabled: false

    # Monitoring disabled - Prometheus Operator CRDs not installed
    monitoring:
      enabled: false

    external:
      enabled: false

    listeners:
      admin:
        port: 9644
        tls:
          enabled: false
        external:
          default:
            enabled: false
      kafka:
        port: 9092  # Keep 9092 for compatibility with existing services
        tls:
          enabled: false
        external:
          default:
            enabled: false
      http:
        enabled: true
        port: 8082
      schemaRegistry:
        enabled: false
