---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: mcp-routes
  namespace: traefik
spec:
  entryPoints:
    - web  # Port 8000
  routes:
    # Kubernetes MCP Server
    # Incoming: /models/kubernetes/{mcp,sse,message}
    # Strip: /models/kubernetes
    # Server receives: /{mcp,sse,message}
    - match: Host(`api.k12n.com`) && PathPrefix(`/models/kubernetes/`)
      kind: Rule
      middlewares:
        - name: https-scheme
          namespace: traefik
        - name: cors
          namespace: traefik
        - name: security-headers
          namespace: traefik
        - name: mcp-kubernetes-stripprefix
          namespace: traefik
      services:
        - name: kubernetes-mcp-server
          namespace: kubernetes-mcp-server
          port: 8080

---
# Middleware to strip /models/kubernetes prefix
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: mcp-kubernetes-stripprefix
  namespace: traefik
spec:
  stripPrefix:
    prefixes:
      - /models/kubernetes
