# MQTT to Redpanda bridge configuration for local development
# Maps MQTT topics from mqtt-generator to Redpanda topics

mqtt:
  host: "mosquitto.mosquitto.svc.cluster.local"
  port: 1883
  client_id: "mqtt-input-local"
  username: null
  password: null
  keep_alive_secs: 30
  clean_session: true
  protocol: "v5"

redpanda:
  # Will be overridden by REDPANDA_BROKERS env var in k8s deployment
  brokers: "redpanda-v2.redpanda-v2.svc.cluster.local:9093"

pipelines:
  # Energy data pipeline
  - name: "energy-realtime"
    topic: "homelab/energy/realtime"
    qos: 1
    redpanda_topic: "homelab-energy-realtime"
    timestamp:
      path: "$.timestamp"
      format: "rfc3339"
      use_now: true
    tags:
      source: "mqtt-generator"
      location: "homelab"
    fields:
      power_w:
        path: "$.power_w"
        type: "float"
      voltage_v:
        path: "$.voltage_v"
        type: "float"
      current_a:
        path: "$.current_a"
        type: "float"
      energy_kwh:
        path: "$.energy_kwh"
        type: "float"

  # Indoor temperature pipeline
  - name: "temperature-indoor"
    topic: "homelab/temperature/indoor"
    qos: 1
    redpanda_topic: "homelab-temperature-indoor"
    timestamp:
      path: "$.timestamp"
      format: "rfc3339"
      use_now: true
    tags:
      source: "mqtt-generator"
      location: "indoor"
      room: "$.room"
    fields:
      temperature_c:
        path: "$.temperature_c"
        type: "float"
      humidity_pct:
        path: "$.humidity_pct"
        type: "float"

  # Outdoor temperature pipeline
  - name: "temperature-outdoor"
    topic: "homelab/temperature/outdoor"
    qos: 1
    redpanda_topic: "homelab-temperature-outdoor"
    timestamp:
      path: "$.timestamp"
      format: "rfc3339"
      use_now: true
    tags:
      source: "mqtt-generator"
      location: "outdoor"
    fields:
      temperature_c:
        path: "$.temperature_c"
        type: "float"
      humidity_pct:
        path: "$.humidity_pct"
        type: "float"
      wind_speed_ms:
        path: "$.wind_speed_ms"
        type: "float"
      pressure_hpa:
        path: "$.pressure_hpa"
        type: "float"

  # Heatpump status pipeline (from mqtt-generator heatpump stream)
  - name: "heatpump-status"
    topic: "homelab/heatpump/status"
    qos: 1
    redpanda_topic: "homelab-heatpump-status"
    timestamp:
      path: "$.timestamp"
      format: "rfc3339"
      use_now: true
    tags:
      device_id: "heatpump-01"
      source: "mqtt-generator"
    fields:
      supply_temp_c:
        path: "$.supply_temp_c"
        type: "float"
      return_temp_c:
        path: "$.return_temp_c"
        type: "float"
      outdoor_temp_c:
        path: "$.outdoor_temp_c"
        type: "float"
      cop:
        path: "$.cop"
        type: "float"
      power_kw:
        path: "$.power_kw"
        type: "float"
      mode:
        path: "$.mode"
        type: "text"
      compressor_on:
        path: "$.compressor_on"
        type: "bool"
