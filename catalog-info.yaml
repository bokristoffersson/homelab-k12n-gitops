apiVersion: backstage.io/v1alpha1
kind: System
metadata:
  name: homelab
  description: Homelab Kubernetes infrastructure and applications
spec:
  owner: homelab-admins

---
apiVersion: backstage.io/v1alpha1
kind: Group
metadata:
  name: homelab-admins
  description: Homelab administrators
spec:
  type: team
  children: []

---
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: heatpump-web
  description: Heat pump dashboard web application
  annotations:
    github.com/project-slug: bokristoffersson/homelab-k12n-gitops
    backstage.io/kubernetes-id: heatpump-web
    backstage.io/techdocs-ref: dir:./applications/heatpump-web
spec:
  type: website
  lifecycle: production
  owner: homelab-admins
  system: homelab

---
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: homelab-api
  description: Homelab REST API
  annotations:
    github.com/project-slug: bokristoffersson/homelab-k12n-gitops
    backstage.io/kubernetes-id: homelab-api
    backstage.io/techdocs-ref: dir:./applications/homelab-api
spec:
  type: service
  lifecycle: production
  owner: homelab-admins
  system: homelab
  providesApis:
    - homelab-api

---
apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: homelab-api
  description: Homelab REST API
  annotations:
    github.com/project-slug: bokristoffersson/homelab-k12n-gitops
spec:
  type: openapi
  lifecycle: production
  owner: homelab-admins
  system: homelab
  definition: |
    openapi: 3.0.0
    info:
      title: Homelab API
      version: 1.0.0
    paths:
      /api/v1/energy/latest:
        get:
          summary: Get latest energy data
      /api/v1/heatpump/latest:
        get:
          summary: Get latest heatpump status

---
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: energy-ws
  description: WebSocket server for real-time energy data streaming
  annotations:
    github.com/project-slug: bokristoffersson/homelab-k12n-gitops
    backstage.io/kubernetes-id: energy-ws
    backstage.io/techdocs-ref: dir:./applications/energy-ws
    kafka.apache.org/consumer-groups: redpanda-v2/energy-ws
spec:
  type: service
  lifecycle: production
  owner: homelab-admins
  system: homelab

---
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: heatpump-settings
  description: Heat pump settings service
  annotations:
    github.com/project-slug: bokristoffersson/homelab-k12n-gitops
    backstage.io/kubernetes-id: heatpump-settings
    backstage.io/techdocs-ref: dir:./applications/heatpump-settings
    kafka.apache.org/consumer-groups: redpanda-v2/heatpump-settings
spec:
  type: service
  lifecycle: production
  owner: homelab-admins
  system: homelab

---
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: mqtt-kafka-bridge
  description: Bridge service between MQTT and Kafka, producing to homelab.energy, homelab.heatpump, and homelab.temperature topics
  annotations:
    github.com/project-slug: bokristoffersson/homelab-k12n-gitops
    backstage.io/kubernetes-id: mqtt-kafka-bridge
    backstage.io/techdocs-ref: dir:./applications/mqtt-kafka-bridge
    kafka.apache.org/producer-topics: homelab.energy,homelab.heatpump,homelab.temperature
spec:
  type: service
  lifecycle: production
  owner: homelab-admins
  system: homelab

---
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: mosquitto
  description: MQTT broker for IoT device communication
  annotations:
    github.com/project-slug: bokristoffersson/homelab-k12n-gitops
    backstage.io/kubernetes-id: mosquitto
spec:
  type: service
  lifecycle: production
  owner: homelab-admins
  system: homelab

---
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: redpanda-sink-timescaledb
  description: Redpanda Connect sink that streams Kafka data to TimescaleDB
  annotations:
    github.com/project-slug: bokristoffersson/homelab-k12n-gitops
    backstage.io/kubernetes-id: redpanda-connect
    backstage.io/kubernetes-namespace: timescaledb
    backstage.io/techdocs-ref: dir:./gitops/apps/base/timescaledb/docs
    kafka.apache.org/consumer-groups: redpanda-v2/timescaledb-energy,redpanda-v2/timescaledb-heatpump,redpanda-v2/timescaledb-temperature
spec:
  type: service
  lifecycle: production
  owner: homelab-admins
  system: homelab
  dependsOn:
    - resource:default/timescaledb
    - component:default/mqtt-kafka-bridge

---
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: redpanda-sink-heatpump-settings
  description: Redpanda Connect processor for heatpump settings data
  annotations:
    github.com/project-slug: bokristoffersson/homelab-k12n-gitops
    backstage.io/kubernetes-id: redpanda-connect
    backstage.io/kubernetes-namespace: heatpump-settings
    backstage.io/techdocs-ref: dir:./gitops/apps/base/heatpump-settings/docs
    kafka.apache.org/consumer-groups: redpanda-v2/heatpump-settings
spec:
  type: service
  lifecycle: production
  owner: homelab-admins
  system: homelab
  dependsOn:
    - component:default/mqtt-kafka-bridge

---
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: grafana
  description: Metrics visualization and dashboards
  annotations:
    github.com/project-slug: bokristoffersson/homelab-k12n-gitops
    backstage.io/kubernetes-id: grafana
spec:
  type: website
  lifecycle: production
  owner: homelab-admins
  system: homelab

---
apiVersion: backstage.io/v1alpha1
kind: Resource
metadata:
  name: timescaledb
  description: TimescaleDB time-series database
  annotations:
    github.com/project-slug: bokristoffersson/homelab-k12n-gitops
    backstage.io/kubernetes-id: timescaledb
    backstage.io/techdocs-ref: dir:./gitops/apps/base/timescaledb
    kafka.apache.org/consumer-groups: redpanda-v2/timescaledb-energy,redpanda-v2/timescaledb-heatpump,redpanda-v2/timescaledb-temperature
spec:
  type: database
  lifecycle: production
  owner: homelab-admins
  system: homelab

---
apiVersion: backstage.io/v1alpha1
kind: User
metadata:
  name: bo.kristoffersson
spec:
  profile:
    displayName: Bo Kristoffersson
    email: bo.kristoffersson@me.com
  memberOf: [homelab-admins]
